local dir = "HeatherX"

if not isfolder(dir) then
    makefolder(dir)
end

local CG = game:GetService("CoreGui")
local TS = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local C = {
    BG = Color3.fromRGB(25, 15, 35),
    SEC = Color3.fromRGB(40, 30, 55),
    PANEL = Color3.fromRGB(55, 45, 70),
    ACC = Color3.fromRGB(230, 140, 200),
    ACCL = Color3.fromRGB(250, 160, 220),
    ACCD = Color3.fromRGB(210, 120, 180),
    TXT = Color3.fromRGB(255, 255, 255),
    TXT2 = Color3.fromRGB(220, 220, 230),
    SUC = Color3.fromRGB(180, 230, 190),
    WARN = Color3.fromRGB(250, 200, 160),
    ERR = Color3.fromRGB(250, 150, 170),
    LAVENDER = Color3.fromRGB(200, 180, 250),
    PINK = Color3.fromRGB(250, 180, 220),
    BORDER = Color3.fromRGB(90, 70, 110),
    CODE_BG = Color3.fromRGB(20, 10, 30)
}

local function cEl(type, parent, props)
    local el = Instance.new(type, parent)
    
    for prop, val in pairs(props or {}) do
        el[prop] = val
    end
    
    if type == "TextButton" or type == "TextLabel" or type == "TextBox" then
        el.TextColor3 = C.TXT
        el.Font = Enum.Font.Gotham
        
        if not props.BackgroundColor3 then
            el.BackgroundColor3 = C.SEC
        end
    end
    
    if type == "Frame" or type == "ScrollingFrame" then
        if not props.BackgroundColor3 then
            el.BackgroundColor3 = C.SEC
        end
    end
    
    if type ~= "UIListLayout" and type ~= "UIPadding" and type ~= "UICorner" and type ~= "UIStroke" then
        local corner = Instance.new("UICorner", el)
        corner.CornerRadius = UDim.new(0, 8)
        
        if type ~= "ImageLabel" and type ~= "ImageButton" then
            local stroke = Instance.new("UIStroke", el)
            stroke.Color = C.BORDER
            stroke.Thickness = 1
            stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            stroke.Transparency = 0.7
        end
    end
    
    return el
end

local function cBtn(parent, text, pos, size, color, callback)
    local btn = cEl("TextButton", parent, {
        Size = size or UDim2.new(0, 120, 0, 35),
        Position = pos,
        BackgroundColor3 = color or C.ACC,
        Text = text,
        TextSize = 14,
        AutoButtonColor = false
    })
    
    if btn:FindFirstChildOfClass("UIStroke") then
        btn:FindFirstChildOfClass("UIStroke"):Destroy()
    end
    
    local shadow = cEl("ImageLabel", btn, {
        Size = UDim2.new(1, 6, 1, 6),
        Position = UDim2.new(0, -3, 0, -3),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.7,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450),
        ZIndex = btn.ZIndex - 1
    })
    
    btn.MouseEnter:Connect(function()
        TS:Create(btn, TweenInfo.new(0.2), {
            BackgroundColor3 = color and color:Lerp(Color3.new(1, 1, 1), 0.1) or C.ACCL
        }):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        TS:Create(btn, TweenInfo.new(0.2), {
            BackgroundColor3 = color or C.ACC
        }):Play()
    end)
    
    btn.MouseButton1Down:Connect(function()
        TS:Create(btn, TweenInfo.new(0.1), {
            Size = UDim2.new(btn.Size.X.Scale, btn.Size.X.Offset * 0.95, btn.Size.Y.Scale, btn.Size.Y.Offset * 0.95),
            Position = UDim2.new(btn.Position.X.Scale, btn.Position.X.Offset + btn.Size.X.Offset * 0.025, btn.Position.Y.Scale, btn.Position.Y.Offset + btn.Size.Y.Offset * 0.025)
        }):Play()
    end)
    
    btn.MouseButton1Up:Connect(function()
        TS:Create(btn, TweenInfo.new(0.1), {
            Size = size or UDim2.new(0, 120, 0, 35),
            Position = pos
        }):Play()
    end)
    
    if callback then
        btn.MouseButton1Click:Connect(callback)
    end
    
    return btn
end

local function cIBtn(parent, icon, pos, size, color, callback)
    local btn = cEl("ImageButton", parent, {
        Size = size or UDim2.new(0, 32, 0, 32),
        Position = pos,
        BackgroundColor3 = color or C.PANEL,
        Image = icon,
        ScaleType = Enum.ScaleType.Fit,
        ImageColor3 = C.TXT,
        AutoButtonColor = false
    })
    
    btn.MouseEnter:Connect(function()
        TS:Create(btn, TweenInfo.new(0.2), {
            BackgroundColor3 = color and color:Lerp(Color3.new(1, 1, 1), 0.1) or C.SEC,
            ImageColor3 = C.LAVENDER
        }):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        TS:Create(btn, TweenInfo.new(0.2), {
            BackgroundColor3 = color or C.PANEL,
            ImageColor3 = C.TXT
        }):Play()
    end)
    
    if callback then
        btn.MouseButton1Click:Connect(callback)
    end
    
    return btn
end

local function lScr(dir)
    local scr = {}
    for _, file in ipairs(listfiles(dir)) do
        if file:sub(-4) == ".lua" then
            table.insert(scr, file)
        end
    end
    return scr
end

local function openCon()
    game:GetService("StarterGui"):SetCore("DevConsoleVisible", true)
end

local function getScreenSize()
    local viewportSize = workspace.CurrentCamera.ViewportSize
    return viewportSize.X, viewportSize.Y
end

local function getScaleFactor()
    local screenWidth, screenHeight = getScreenSize()
    local baseDimension = 1080
    local scaleFactor = math.min(screenWidth, screenHeight) / baseDimension
    return math.max(0.7, math.min(1.5, scaleFactor))
end

local function isMobile()
    local screenWidth, screenHeight = getScreenSize()
    local aspectRatio = screenWidth / screenHeight
    local isTouchDevice = UIS.TouchEnabled and not UIS.KeyboardEnabled and not UIS.MouseEnabled
    
    return isTouchDevice or aspectRatio < 1 or screenWidth < 600
end

local function isLandscape()
    local screenWidth, screenHeight = getScreenSize()
    return screenWidth > screenHeight
end

local function createFeather(parent, size, position)
    local feather = cEl("ImageLabel", parent, {
        Size = UDim2.new(0, size, 0, size * 2),
        Position = position,
        BackgroundTransparency = 1,
        Image = "rbxassetid://116872248658338",
        ImageColor3 = math.random() > 0.5 and C.LAVENDER or C.PINK,
        ImageTransparency = 0.7,
        Rotation = math.random(-20, 20),
        ZIndex = 1
    })
    
    local startY = position.Y.Offset
    local endY = parent.AbsoluteSize.Y + 50
    local duration = math.random(8, 15)
    local rotationAmount = math.random(-180, 180)
    
    TS:Create(feather, TweenInfo.new(duration, Enum.EasingStyle.Linear), {
        Position = UDim2.new(position.X.Scale, position.X.Offset + math.random(-100, 100), 0, endY),
        Rotation = feather.Rotation + rotationAmount,
        ImageTransparency = 1
    }):Play()
    
    task.delay(duration, function()
        feather:Destroy()
    end)
    
    return feather
end

local function spawnFeathers(parent)
    local connection
    connection = game:GetService("RunService").Heartbeat:Connect(function()
        if not parent or not parent.Parent then
            connection:Disconnect()
            return
        end
        
        if math.random() < 0.03 then
            local size = math.random(15, 30)
            local position = UDim2.new(math.random(), 0, 0, -size)
            createFeather(parent, size, position)
        end
    end)
    
    return connection
end

local function showNotification(title, message, type)
    local screenWidth, screenHeight = getScreenSize()
    local notifWidth = math.min(screenWidth * 0.3, 300)
    local notifHeight = 70
    
    local color = C.ACC
    if type == "success" then color = C.SUC
    elseif type == "warning" then color = C.WARN
    elseif type == "error" then color = C.ERR
    end
    
    local notif = cEl("Frame", CG:FindFirstChild("HXEd"), {
        Size = UDim2.new(0, notifWidth, 0, notifHeight),
        Position = UDim2.new(1, 10, 0, 10),
        BackgroundColor3 = C.BG,
        ZIndex = 100
    })
    
    local corner = notif:FindFirstChildOfClass("UICorner")
    if corner then
        corner.CornerRadius = UDim.new(0, 12)
    end
    
    local shadow = cEl("ImageLabel", notif, {
        Size = UDim2.new(1, 30, 1, 30),
        Position = UDim2.new(0, -15, 0, -15),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6014261993",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450),
        ZIndex = 99
    })
    
    local topBar = cEl("Frame", notif, {
        Size = UDim2.new(1, 0, 0, 6),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = color,
        ZIndex = 101
    })
    
    local topCorner = topBar:FindFirstChildOfClass("UICorner")
    if topCorner then
        topCorner.CornerRadius = UDim.new(0, 12)
    end
    
    local titleLabel = cEl("TextLabel", notif, {
        Size = UDim2.new(1, -50, 0, 25),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1,
        Text = title,
        TextSize = 16,
        Font = Enum.Font.GothamBold,
        TextColor3 = C.TXT,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 101
    })
    
    local msgLabel = cEl("TextLabel", notif, {
        Size = UDim2.new(1, -50, 0, 25),
        Position = UDim2.new(0, 10, 0, 35),
        BackgroundTransparency = 1,
        Text = message,
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextColor3 = C.TXT2,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 101
    })
    
    local icon
    if type == "success" then
        icon = "rbxassetid://6022668885"
    elseif type == "warning" then
        icon = "rbxassetid://6031071053"
    elseif type == "error" then
        icon = "rbxassetid://6031071057"
    else
        icon = "rbxassetid://6022668885"
    end
    
    local iconLabel = cEl("ImageLabel", notif, {
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(1, -34, 0, 23),
        BackgroundTransparency = 1,
        Image = icon,
        ImageColor3 = color,
        ZIndex = 101
    })
    
    TS:Create(notif, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -notifWidth - 20, 0, 10)
    }):Play()
    
    task.delay(2.5, function()
        TS:Create(notif, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Position = UDim2.new(1, 10, 0, 10)
        }):Play()
        
        task.delay(0.3, function()
            notif:Destroy()
        end)
    end)
    
    return notif
end

local function searchScriptBlox(query, callback)
    local success, result = pcall(function()
        return game:HttpGet("https://scriptblox.com/api/script/search?q=" .. HttpService:UrlEncode(query))
    end)
    
    if success then
        local data = HttpService:JSONDecode(result)
        callback(true, data.result.scripts)
    else
        callback(false, result)
    end
end

local function getScriptFromSlug(slug, callback)
    local success, result = pcall(function()
        return game:HttpGet("https://scriptblox.com/api/script/" .. slug)
    end)
    
    if success then
        local data = HttpService:JSONDecode(result)
        if data and data.script then
            callback(true, data.script)
        else
            callback(false, "Script content not found")
        end
    else
        callback(false, "Failed to load script")
    end
end

local function createLineNumbers(parent, lines)
    local lineContainer = cEl("Frame", parent, {
        Size = UDim2.new(0, 30, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.BG,
        ZIndex = 5
    })
    
    local lineScroll = cEl("ScrollingFrame", lineContainer, {
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1,
        ScrollBarThickness = 0,
        ScrollingEnabled = false,
        CanvasSize = UDim2.new(0, 0, 0, 20 * lines),
        ZIndex = 5
    })
    
    for i = 1, lines do
        local lineLabel = cEl("TextLabel", lineScroll, {
            Size = UDim2.new(1, -5, 0, 20),
            Position = UDim2.new(0, 0, 0, (i-1) * 20),
            BackgroundTransparency = 1,
            Text = tostring(i),
            TextSize = 12,
            Font = Enum.Font.Code,
            TextColor3 = C.PINK:Lerp(C.TXT, 0.5),
            TextXAlignment = Enum.TextXAlignment.Right,
            ZIndex = 5
        })
    end
    
    return lineContainer, lineScroll
end

local function updateLineNumbers(lineScroll, textBox)
    local lines = 1
    local text = textBox.Text
    
    for i = 1, #text do
        if text:sub(i, i) == "\n" then
            lines = lines + 1
        end
    end
    
    lineScroll.CanvasSize = UDim2.new(0, 0, 0, 20 * lines)
    
    local existingLines = #lineScroll:GetChildren()
    if existingLines > lines then
        for i = lines + 1, existingLines do
            local lineLabel = lineScroll:FindFirstChild(tostring(i))
            if lineLabel then
                lineLabel:Destroy()
            end
        end
    elseif existingLines < lines then
        for i = existingLines + 1, lines do
            local lineLabel = cEl("TextLabel", lineScroll, {
                Name = tostring(i),
                Size = UDim2.new(1, -5, 0, 20),
                Position = UDim2.new(0, 0, 0, (i-1) * 20),
                BackgroundTransparency = 1,
                Text = tostring(i),
                TextSize = 12,
                Font = Enum.Font.Code,
                TextColor3 = C.PINK:Lerp(C.TXT, 0.5),
                TextXAlignment = Enum.TextXAlignment.Right,
                ZIndex = 5
            })
        end
    end
    
    lineScroll.CanvasPosition = Vector2.new(0, textBox.CanvasPosition.Y)
end

local function showEd()
    if CG:FindFirstChild("HXEd") then 
        CG:FindFirstChild("HXEd"):Destroy()
    end

    local screenWidth, screenHeight = getScreenSize()
    local scaleFactor = getScaleFactor()
    local mobile = isMobile()
    local landscape = isLandscape()
    
    local sg = cEl("ScreenGui", CG, {
        Name = "HXEd",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    local mf = cEl("Frame", sg, {
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.BG,
        BackgroundTransparency = 0.1
    })
    
    local corner = mf:FindFirstChildOfClass("UICorner")
    if corner then
        corner:Destroy()
    end
    
    local featherConnection = spawnFeathers(mf)
    
    local headerHeight = landscape and 30 * scaleFactor or 40 * scaleFactor
    local navHeight = landscape and 30 * scaleFactor or 35 * scaleFactor
    local footerHeight = landscape and 30 * scaleFactor or 35 * scaleFactor
    
    local tb = cEl("Frame", mf, {
        Size = UDim2.new(1, 0, 0, headerHeight),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.PANEL
    })
    
    local tbCorner = tb:FindFirstChildOfClass("UICorner")
    if tbCorner then
        tbCorner:Destroy()
    end
    
    local tg = Instance.new("UIGradient", tb)
    tg.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, C.PANEL),
        ColorSequenceKeypoint.new(1, C.PANEL:Lerp(C.PINK, 0.3))
    })
    tg.Rotation = 90
    
    local logoSize = landscape and 20 * scaleFactor or 24 * scaleFactor
    
    local logo = cEl("ImageLabel", tb, {
        Size = UDim2.new(0, logoSize, 0, logoSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -logoSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://116872248658338",
        ImageColor3 = C.PINK,
        ZIndex = 5
    })
    
    local executorName = "HeatherX"
    pcall(function()
        local info = {identifyexecutor()}
        if #info > 0 then
            executorName = table.concat(info, " ")
        end
    end)
    
    local titleSize = landscape and 14 * scaleFactor or 18 * scaleFactor
    
    local tl = cEl("TextLabel", tb, {
        Size = UDim2.new(1, -100 * scaleFactor, 1, 0),
        Position = UDim2.new(0, logoSize + 16 * scaleFactor, 0, 0),
        BackgroundTransparency = 1,
        Text = executorName,
        TextSize = titleSize,
        Font = Enum.Font.GothamBold,
        TextColor3 = C.PINK,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 5
    })
    
    local tlGradient = Instance.new("UIGradient", tl)
    tlGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, C.PINK),
        ColorSequenceKeypoint.new(0.5, C.LAVENDER),
        ColorSequenceKeypoint.new(1, C.PINK)
    })
    tlGradient.Offset = Vector2.new(0, 0)
    
    local tlStroke = Instance.new("UIStroke", tl)
    tlStroke.Color = C.LAVENDER
    tlStroke.Thickness = 0.5
    tlStroke.Transparency = 0.7
    
    local clBtnSize = landscape and 20 * scaleFactor or 24 * scaleFactor
    
    local clBtn = cIBtn(tb, "rbxassetid://6031094678", 
        UDim2.new(1, -clBtnSize - 8 * scaleFactor, 0.5, -clBtnSize/2), 
        UDim2.new(0, clBtnSize, 0, clBtnSize), 
        C.PANEL, 
        function()
            sg:Destroy()
        end
    )
    
    local navBar = cEl("Frame", mf, {
        Size = UDim2.new(1, 0, 0, navHeight),
        Position = UDim2.new(0, 0, 0, headerHeight),
        BackgroundColor3 = C.PANEL
    })
    
    local navBarCorner = navBar:FindFirstChildOfClass("UICorner")
    if navBarCorner then
        navBarCorner:Destroy()
    end
    
    local navBtnWidth = 1/4
    local navTextSize = landscape and 12 * scaleFactor or 14 * scaleFactor
    
    local editorBtn = cEl("TextButton", navBar, {
        Size = UDim2.new(navBtnWidth, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.ACC,
        Text = "Editor",
        TextSize = navTextSize
    })
    
    local editorBtnCorner = editorBtn:FindFirstChildOfClass("UICorner")
    if editorBtnCorner then
        editorBtnCorner:Destroy()
    end
    
    local scriptsBtn = cEl("TextButton", navBar, {
        Size = UDim2.new(navBtnWidth, 0, 1, 0),
        Position = UDim2.new(navBtnWidth, 0, 0, 0),
        BackgroundColor3 = C.SEC,
        Text = "Scripts",
        TextSize = navTextSize
    })
    
    local scriptsBtnCorner = scriptsBtn:FindFirstChildOfClass("UICorner")
    if scriptsBtnCorner then
        scriptsBtnCorner:Destroy()
    end
    
    local utilsBtn = cEl("TextButton", navBar, {
        Size = UDim2.new(navBtnWidth, 0, 1, 0),
        Position = UDim2.new(navBtnWidth * 2, 0, 0, 0),
        BackgroundColor3 = C.SEC,
        Text = "Utils",
        TextSize = navTextSize
    })
    
    local utilsBtnCorner = utilsBtn:FindFirstChildOfClass("UICorner")
    if utilsBtnCorner then
        utilsBtnCorner:Destroy()
    end
    
    local cloudBtn = cEl("TextButton", navBar, {
        Size = UDim2.new(navBtnWidth, 0, 1, 0),
        Position = UDim2.new(navBtnWidth * 3, 0, 0, 0),
        BackgroundColor3 = C.SEC,
        Text = "Cloud",
        TextSize = navTextSize
    })
    
    local cloudBtnCorner = cloudBtn:FindFirstChildOfClass("UICorner")
    if cloudBtnCorner then
        cloudBtnCorner:Destroy()
    end
    
    local contentPanel = cEl("Frame", mf, {
        Size = UDim2.new(1, 0, 1, -(headerHeight + navHeight + footerHeight)),
        Position = UDim2.new(0, 0, 0, headerHeight + navHeight),
        BackgroundColor3 = C.PANEL
    })
    
    local contentPanelCorner = contentPanel:FindFirstChildOfClass("UICorner")
    if contentPanelCorner then
        contentPanelCorner:Destroy()
    end
    
    local editorPanel = cEl("Frame", contentPanel, {
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.CODE_BG,
        Visible = true
    })
    
    local editorPanelCorner = editorPanel:FindFirstChildOfClass("UICorner")
    if editorPanelCorner then
        editorPanelCorner:Destroy()
    end
    
    local lineContainer, lineScroll = createLineNumbers(editorPanel, 10)
    
    local ce = cEl("ScrollingFrame", editorPanel, {
        Size = UDim2.new(1, -30, 1, 0),
        Position = UDim2.new(0, 30, 0, 0),
        BackgroundColor3 = C.CODE_BG,
        ScrollBarThickness = 4,
        CanvasSize = UDim2.new(0, 0, 0, 200),
        BorderSizePixel = 0
    })
    
    local ceCorner = ce:FindFirstChildOfClass("UICorner")
    if ceCorner then
        ceCorner:Destroy()
    end
    
    local ceTextBox = cEl("TextBox", ce, {
        Size = UDim2.new(1, -10, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1,
        TextColor3 = C.TXT,
        TextSize = landscape and 14 * scaleFactor or 16 * scaleFactor,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        Font = Enum.Font.Code,
        ClearTextOnFocus = false,
        TextWrapped = false,
        MultiLine = true,
        PlaceholderText = "-- Write your script here",
        Text = "-- Write your script here",
        PlaceholderColor3 = Color3.fromRGB(120, 130, 140)
    })
    
    local pad = Instance.new("UIPadding", ceTextBox)
    pad.PaddingLeft = UDim.new(0, 10)
    pad.PaddingTop = UDim.new(0, 10)
    pad.PaddingRight = UDim.new(0, 10)
    pad.PaddingBottom = UDim.new(0, 10)
    
    ceTextBox:GetPropertyChangedSignal("Text"):Connect(function()
        local lines = 1
        local text = ceTextBox.Text
        
        for i = 1, #text do
            if text:sub(i, i) == "\n" then
                lines = lines + 1
            end
        end
        
        ce.CanvasSize = UDim2.new(0, 0, 0, math.max(200, lines * 20 + 30))
        updateLineNumbers(lineScroll, ce)
    end)
    
    ce:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
        lineScroll.CanvasPosition = Vector2.new(0, ce.CanvasPosition.Y)
    end)
    
    local scriptsPanel = cEl("ScrollingFrame", contentPanel, {
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.BG,
        ScrollBarThickness = 4,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        BorderSizePixel = 0,
        Visible = false
    })
    
    local scriptsPanelCorner = scriptsPanel:FindFirstChildOfClass("UICorner")
    if scriptsPanelCorner then
        scriptsPanelCorner:Destroy()
    end
    
    local scriptsLayout = Instance.new("UIListLayout", scriptsPanel)
    scriptsLayout.Padding = UDim.new(0, 5 * scaleFactor)
    scriptsLayout.SortOrder = Enum.SortOrder.Name
    scriptsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    local scriptsPad = Instance.new("UIPadding", scriptsPanel)
    scriptsPad.PaddingLeft = UDim.new(0, 5 * scaleFactor)
    scriptsPad.PaddingTop = UDim.new(0, 5 * scaleFactor)
    scriptsPad.PaddingRight = UDim.new(0, 5 * scaleFactor)
    scriptsPad.PaddingBottom = UDim.new(0, 5 * scaleFactor)
    
    local utilsPanel = cEl("ScrollingFrame", contentPanel, {
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.BG,
        ScrollBarThickness = 4,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        BorderSizePixel = 0,
        Visible = false
    })
    
    local utilsPanelCorner = utilsPanel:FindFirstChildOfClass("UICorner")
    if utilsPanelCorner then
        utilsPanelCorner:Destroy()
    end
    
    local utilsLayout = Instance.new("UIListLayout", utilsPanel)
    utilsLayout.Padding = UDim.new(0, 5 * scaleFactor)
    utilsLayout.SortOrder = Enum.SortOrder.Name
    utilsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    local utilsPad = Instance.new("UIPadding", utilsPanel)
    utilsPad.PaddingLeft = UDim.new(0, 5 * scaleFactor)
    utilsPad.PaddingTop = UDim.new(0, 5 * scaleFactor)
    utilsPad.PaddingRight = UDim.new(0, 5 * scaleFactor)
    utilsPad.PaddingBottom = UDim.new(0, 5 * scaleFactor)
    
    local cloudPanel = cEl("Frame", contentPanel, {
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.BG,
        Visible = false
    })
    
    local cloudPanelCorner = cloudPanel:FindFirstChildOfClass("UICorner")
    if cloudPanelCorner then
        cloudPanelCorner:Destroy()
    end
    
    local searchBarHeight = landscape and 30 * scaleFactor or 35 * scaleFactor
    
    local searchBar = cEl("Frame", cloudPanel, {
        Size = UDim2.new(1, 0, 0, searchBarHeight),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = C.SEC
    })
    
    local searchBarCorner = searchBar:FindFirstChildOfClass("UICorner")
    if searchBarCorner then
        searchBarCorner:Destroy()
    end
    
    local searchInput = cEl("TextBox", searchBar, {
        Size = UDim2.new(1, -90 * scaleFactor, 1, -6 * scaleFactor),
        Position = UDim2.new(0, 5 * scaleFactor, 0, 3 * scaleFactor),
        BackgroundColor3 = C.BG,
        PlaceholderText = "Search scripts...",
        Text = "",
        TextSize = landscape and 12 * scaleFactor or 14 * scaleFactor,
        ClearTextOnFocus = false
    })
    
    local searchBtn = cBtn(searchBar, "Search", 
        UDim2.new(1, -80 * scaleFactor, 0, 3 * scaleFactor), 
        UDim2.new(0, 75 * scaleFactor, 1, -6 * scaleFactor), 
        C.ACC
    )
    
    local resultsFrame = cEl("ScrollingFrame", cloudPanel, {
        Size = UDim2.new(1, 0, 1, -searchBarHeight),
        Position = UDim2.new(0, 0, 0, searchBarHeight),
        BackgroundTransparency = 1,
        ScrollBarThickness = 4,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        BorderSizePixel = 0
    })
    
    local resultsLayout = Instance.new("UIListLayout", resultsFrame)
    resultsLayout.Padding = UDim.new(0, 5 * scaleFactor)
    resultsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    resultsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    
    local resultsPad = Instance.new("UIPadding", resultsFrame)
    resultsPad.PaddingLeft = UDim.new(0, 5 * scaleFactor)
    resultsPad.PaddingTop = UDim.new(0, 5 * scaleFactor)
    resultsPad.PaddingRight = UDim.new(0, 5 * scaleFactor)
    resultsPad.PaddingBottom = UDim.new(0, 5 * scaleFactor)
    
    local loadingText = cEl("TextLabel", resultsFrame, {
        Size = UDim2.new(1, -10 * scaleFactor, 0, 30 * scaleFactor),
        Position = UDim2.new(0, 5 * scaleFactor, 0, 5 * scaleFactor),
        BackgroundTransparency = 1,
        Text = "Search for scripts using the bar above",
        TextSize = landscape and 12 * scaleFactor or 14 * scaleFactor,
        Font = Enum.Font.Gotham,
        TextColor3 = C.TXT2,
        TextWrapped = true
    })
    
    local function clearResults()
        for _, child in ipairs(resultsFrame:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        loadingText.Visible = true
    end
    
    local function createScriptItem(script, index)
        loadingText.Visible = false
        
        local itemHeight = landscape and 80 * scaleFactor or 90 * scaleFactor
        
        local scriptItem = cEl("Frame", resultsFrame, {
            Size = UDim2.new(1, -10 * scaleFactor, 0, itemHeight),
            BackgroundColor3 = C.SEC,
            LayoutOrder = index
        })
        
        local itemCorner = scriptItem:FindFirstChildOfClass("UICorner")
        if itemCorner then
            itemCorner.CornerRadius = UDim.new(0, 6)
        end
        
        local iconSize = landscape and 60 * scaleFactor or 70 * scaleFactor
        
        local gameIcon = cEl("ImageLabel", scriptItem, {
            Size = UDim2.new(0, iconSize, 0, iconSize),
            Position = UDim2.new(0, 5 * scaleFactor, 0.5, -iconSize/2),
            BackgroundColor3 = C.BG
        })
        
        pcall(function()
            if script.game and script.game.imageUrl and script.game.imageUrl ~= "" then
                gameIcon.Image = script.game.imageUrl
            elseif script.image and script.image ~= "" then
                gameIcon.Image = script.image
            else
                gameIcon.Image = "rbxassetid://116872248658338"
            end
        end)
        
        local titleSize = landscape and 12 * scaleFactor or 14 * scaleFactor
        
        local titleLabel = cEl("TextLabel", scriptItem, {
            Size = UDim2.new(1, -(iconSize + 90 * scaleFactor), 0, 20 * scaleFactor),
            Position = UDim2.new(0, iconSize + 10 * scaleFactor, 0, 5 * scaleFactor),
            BackgroundTransparency = 1,
            Text = script.title or "Unknown Script",
            TextSize = titleSize,
            Font = Enum.Font.GothamBold,
            TextColor3 = C.TXT,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true
        })
        
        local gameSize = landscape and 10 * scaleFactor or 12 * scaleFactor
        
        local gameLabel = cEl("TextLabel", scriptItem, {
            Size = UDim2.new(1, -(iconSize + 90 * scaleFactor), 0, 15 * scaleFactor),
            Position = UDim2.new(0, iconSize + 10 * scaleFactor, 0, 25 * scaleFactor),
            BackgroundTransparency = 1,
            Text = script.game and script.game.name or "Unknown Game",
            TextSize = gameSize,
            Font = Enum.Font.Gotham,
            TextColor3 = C.TXT2,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true
        })
        
        local typeSize = landscape and 10 * scaleFactor or 11 * scaleFactor
        
        local typeLabel = cEl("TextLabel", scriptItem, {
            Size = UDim2.new(0, 80 * scaleFactor, 0, 20 * scaleFactor),
            Position = UDim2.new(0, iconSize + 10 * scaleFactor, 0, itemHeight - 25 * scaleFactor),
            BackgroundColor3 = C.PANEL,
            Text = script.scriptType or "Script",
            TextSize = typeSize,
            Font = Enum.Font.GothamBold
        })
        
        if script.verified then
            local verifiedIcon = cEl("ImageLabel", scriptItem, {
                Size = UDim2.new(0, 16 * scaleFactor, 0, 16 * scaleFactor),
                Position = UDim2.new(1, -90 * scaleFactor, 0, 5 * scaleFactor),
                BackgroundTransparency = 1,
                Image = "rbxassetid://6031075931",
                ImageColor3 = C.SUC
            })
        end
        
        local viewsSize = landscape and 10 * scaleFactor or 11 * scaleFactor
        
        local viewsLabel = cEl("TextLabel", scriptItem, {
            Size = UDim2.new(0, 70 * scaleFactor, 0, 15 * scaleFactor),
            Position = UDim2.new(1, -80 * scaleFactor, 0, 25 * scaleFactor),
            BackgroundTransparency = 1,
            Text = (script.views or 0) .. " views",
            TextSize = viewsSize,
            Font = Enum.Font.Gotham,
            TextColor3 = C.TXT2,
            TextXAlignment = Enum.TextXAlignment.Right
        })
        
        local executeBtn = cBtn(scriptItem, "Execute", 
            UDim2.new(1, -80 * scaleFactor, 0, itemHeight - 25 * scaleFactor), 
            UDim2.new(0, 70 * scaleFactor, 0, 20 * scaleFactor), 
            C.ACC, 
            function()
                loadingText.Text = "Loading script..."
                loadingText.Visible = true
                
                getScriptFromSlug(script.slug, function(success, scriptContent)
                    if success then
                        ceTextBox.Text = scriptContent
                        showNotification("Script Loaded", script.title, "success")
                        editorBtn.MouseButton1Click:Fire()
                    else
                        showNotification("Error", scriptContent, "error")
                    end
                    
                    loadingText.Visible = false
                end)
            end
        )
        
        return scriptItem
    end
    
    searchBtn.MouseButton1Click:Connect(function()
        local query = searchInput.Text
        if query and query:len() > 0 then
            clearResults()
            loadingText.Text = "Searching..."
            loadingText.Visible = true
            
            searchScriptBlox(query, function(success, scripts)
                if success then
                    clearResults()
                    if #scripts == 0 then
                        loadingText.Text = "No scripts found"
                        loadingText.Visible = true
                    else
                        for i, script in ipairs(scripts) do
                            createScriptItem(script, i)
                        end
                    end
                else
                    loadingText.Text = "Error: " .. tostring(scripts)
                    loadingText.Visible = true
                end
            end)
        end
    end)
    
    searchInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            searchBtn.MouseButton1Click:Fire()
        end
    end)
    
    local function createUtilityItem(name, description, callback)
        local itemHeight = landscape and 60 * scaleFactor or 70 * scaleFactor
        
        local uItem = cEl("Frame", utilsPanel, {
            Size = UDim2.new(1, -10 * scaleFactor, 0, itemHeight),
            BackgroundColor3 = C.SEC
        })
        
        local uiCorner = uItem:FindFirstChildOfClass("UICorner")
        if uiCorner then
            uiCorner.CornerRadius = UDim.new(0, 6)
        end
        
        local iconSize = landscape and 24 * scaleFactor or 28 * scaleFactor
        
        local uIcon = cEl("ImageLabel", uItem, {
            Size = UDim2.new(0, iconSize, 0, iconSize),
            Position = UDim2.new(0, 10 * scaleFactor, 0.5, -iconSize/2),
            BackgroundTransparency = 1,
            Image = "rbxassetid://116872248658338",
            ImageColor3 = C.LAVENDER
        })
        
        local nameSize = landscape and 12 * scaleFactor or 14 * scaleFactor
        
        local uName = cEl("TextLabel", uItem, {
            Size = UDim2.new(1, -(iconSize + 130 * scaleFactor), 0, 20 * scaleFactor),
            Position = UDim2.new(0, iconSize + 20 * scaleFactor, 0, 10 * scaleFactor),
            BackgroundTransparency = 1,
            Text = name,
            TextSize = nameSize,
            Font = Enum.Font.GothamBold,
            TextColor3 = C.TXT,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local descSize = landscape and 10 * scaleFactor or 12 * scaleFactor
        
        local uDesc = cEl("TextLabel", uItem, {
            Size = UDim2.new(1, -(iconSize + 130 * scaleFactor), 0, 20 * scaleFactor),
            Position = UDim2.new(0, iconSize + 20 * scaleFactor, 0, 30 * scaleFactor),
            BackgroundTransparency = 1,
            Text = description,
            TextSize = descSize,
            Font = Enum.Font.Gotham,
            TextColor3 = C.TXT2,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true
        })
        
        local uBtn = cBtn(uItem, "Execute", 
            UDim2.new(1, -110 * scaleFactor, 0.5, -15 * scaleFactor), 
            UDim2.new(0, 100 * scaleFactor, 0, 30 * scaleFactor), 
            C.ACC, 
            function()
                callback()
                showNotification("Executed", name, "success")
            end
        )
        
        return uItem
    end
    
    local infiniteYieldBtn = createUtilityItem(
        "Infinite Yield", 
        "FE Admin Commands",
        function()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
        end
    )
    
    local darkDexBtn = createUtilityItem(
        "Dex Explorer", 
        "Roblox Explorer",
        function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/infyiff/backup/main/dex.lua"))()
        end
    )
    
    local owlHubBtn = createUtilityItem(
        "Owl Hub", 
        "Universal ESP & Aimbot",
        function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/CriShoux/OwlHub/master/OwlHub.txt"))()
        end
    )
    
    local cmdXBtn = createUtilityItem(
        "CMD-X", 
        "Admin Command Script",
        function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/CMD-X/CMD-X/master/Source", true))()
        end
    )
    
    local btnBar = cEl("Frame", mf, {
        Size = UDim2.new(1, 0, 0, footerHeight),
        Position = UDim2.new(0, 0, 1, -footerHeight),
        BackgroundColor3 = C.PANEL
    })
    
    local bbCorner = btnBar:FindFirstChildOfClass("UICorner")
    if bbCorner then
        bbCorner:Destroy()
    end
    
    local function refScr()
        for _, child in ipairs(scriptsPanel:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        local scripts = lScr(dir)
        for _, path in ipairs(scripts) do
            local fileName = path:match("[^/\\]+%.lua$")
            if fileName then
                fileName = fileName:sub(1, -5)
            end
            
            local itemHeight = landscape and 50 * scaleFactor or 60 * scaleFactor
            
            local sItem = cEl("Frame", scriptsPanel, {
                Size = UDim2.new(1, -10 * scaleFactor, 0, itemHeight),
                BackgroundColor3 = C.SEC
            })
            
            local siCorner = sItem:FindFirstChildOfClass("UICorner")
            if siCorner then
                siCorner.CornerRadius = UDim.new(0, 6)
            end
            
            local iconSize = landscape and 24 * scaleFactor or 28 * scaleFactor
            
            local fileIcon = cEl("ImageLabel", sItem, {
                Size = UDim2.new(0, iconSize, 0, iconSize),
                Position = UDim2.new(0, 10 * scaleFactor, 0.5, -iconSize/2),
                BackgroundTransparency = 1,
                Image = "rbxassetid://116872248658338",
                ImageColor3 = C.PINK
            })
            
            local nameSize = landscape and 12 * scaleFactor or 14 * scaleFactor
            
            local sBtn = cEl("TextButton", sItem, {
                Size = UDim2.new(1, -(iconSize + 180 * scaleFactor), 1, 0),
                Position = UDim2.new(0, iconSize + 20 * scaleFactor, 0, 0),
                BackgroundTransparency = 1,
                Text = fileName,
                TextSize = nameSize,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextTruncate = Enum.TextTruncate.AtEnd,
                Font = Enum.Font.Gotham
            })
            
            sBtn.MouseButton1Click:Connect(function()
                local success, content = pcall(readfile, path)
                if success then
                    ceTextBox.Text = content
                    editorBtn.MouseButton1Click:Fire()
                end
            end)
            
            local btnSize = landscape and 25 * scaleFactor or 30 * scaleFactor
            
            local runBtn = cBtn(sItem, "Run", 
                UDim2.new(1, -(170 * scaleFactor), 0.5, -btnSize/2), 
                UDim2.new(0, 70 * scaleFactor, 0, btnSize), 
                C.SUC, 
                function()
                    local success, content = pcall(readfile, path)
                    if success then
                        loadstring(content)()
                        showNotification("Executed", fileName, "success")
                    else
                        showNotification("Error", "Failed to load script", "error")
                    end
                end
            )
            
            local delBtn = cBtn(sItem, "Delete", 
                UDim2.new(1, -(90 * scaleFactor), 0.5, -btnSize/2), 
                UDim2.new(0, 80 * scaleFactor, 0, btnSize), 
                C.ERR, 
                function()
                    pcall(delfile, path)
                    showNotification("Deleted", fileName, "warning")
                    refScr()
                end
            )
        end
    end
    
    local function showSave()
        local blur = cEl("Frame", sg, {
            Size = UDim2.new(1, 0, 1, 0),
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundColor3 = Color3.new(0, 0, 0),
            BackgroundTransparency = 0.5,
            ZIndex = 10
        })
        
        local popupWidth = landscape and 300 * scaleFactor or 350 * scaleFactor
        local popupHeight = landscape and 150 * scaleFactor or 180 * scaleFactor
        
        local sPop = cEl("Frame", blur, {
            Size = UDim2.new(0, popupWidth, 0, popupHeight),
            Position = UDim2.new(0.5, -popupWidth/2, 0.5, -popupHeight/2),
            BackgroundColor3 = C.BG,
            ZIndex = 11
        })
        
        local spCorner = sPop:FindFirstChildOfClass("UICorner")
        if spCorner then
            spCorner.CornerRadius = UDim.new(0, 10)
        end
        
        local popShadow = cEl("ImageLabel", sPop, {
            Size = UDim2.new(1, 30, 1, 30),
            Position = UDim2.new(0, -15, 0, -15),
            BackgroundTransparency = 1,
            Image = "rbxassetid://6014261993",
            ImageColor3 = Color3.fromRGB(0, 0, 0),
            ImageTransparency = 0.6,
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = Rect.new(49, 49, 450, 450),
            ZIndex = 10
        })
        
        local headerHeight = landscape and 35 * scaleFactor or 40 * scaleFactor
        
        local sTit = cEl("TextLabel", sPop, {
            Size = UDim2.new(1, 0, 0, headerHeight),
            Position = UDim2.new(0, 0, 0, 0),
            BackgroundColor3 = C.PANEL,
            Text = "Save Script",
            TextSize = landscape and 14 * scaleFactor or 16 * scaleFactor,
            Font = Enum.Font.GothamBold,
            ZIndex = 12
        })
        
        local stCorner = sTit:FindFirstChildOfClass("UICorner")
        if stCorner then
            stCorner.CornerRadius = UDim.new(0, 10)
        end
        
        local iconSize = landscape and 20 * scaleFactor or 24 * scaleFactor
        
        local saveIcon = cEl("ImageLabel", sTit, {
            Size = UDim2.new(0, iconSize, 0, iconSize),
            Position = UDim2.new(0, 10 * scaleFactor, 0.5, -iconSize/2),
            BackgroundTransparency = 1,
            Image = "rbxassetid://6026568198",
            ImageColor3 = C.LAVENDER,
            ZIndex = 12
        })
        
        local inputHeight = landscape and 30 * scaleFactor or 35 * scaleFactor
        
        local nInp = cEl("TextBox", sPop, {
            Size = UDim2.new(1, -20 * scaleFactor, 0, inputHeight),
            Position = UDim2.new(0, 10 * scaleFactor, 0, headerHeight + 10 * scaleFactor),
            BackgroundColor3 = C.SEC,
            Text = "",
            PlaceholderText = "Script name",
            TextSize = landscape and 12 * scaleFactor or 14 * scaleFactor,
            ZIndex = 12
        })
        
        local niCorner = nInp:FindFirstChildOfClass("UICorner")
        if niCorner then
            niCorner.CornerRadius = UDim.new(0, 8)
        end
        
        local btnHeight = landscape and 30 * scaleFactor or 35 * scaleFactor
        
        local btnBar = cEl("Frame", sPop, {
            Size = UDim2.new(1, -20 * scaleFactor, 0, btnHeight),
            Position = UDim2.new(0, 10 * scaleFactor, 1, -(btnHeight + 10 * scaleFactor)),
            BackgroundTransparency = 1,
            ZIndex = 12
        })
        
        local cSBtn = cBtn(btnBar, "Cancel", UDim2.new(0, 0, 0, 0), UDim2.new(0.48, 0, 1, 0), C.ERR, function()
            blur:Destroy()
        end)
        
        local cfSBtn = cBtn(btnBar, "Save", UDim2.new(0.52, 0, 0, 0), UDim2.new(0.48, 0, 1, 0), C.SUC, function()
            local name = nInp.Text
            if name == "" then name = "Script_" .. os.time() end
            if not name:match("%.lua$") then name = name .. ".lua" end
            
            writefile(dir .. "/" .. name, ceTextBox.Text)
            showNotification("Saved", name:sub(1, -5), "success")
            blur:Destroy()
            refScr()
        end)
        
        local clPopBtn = cIBtn(sTit, "rbxassetid://6031094678", 
            UDim2.new(1, -iconSize - 10 * scaleFactor, 0.5, -iconSize/2), 
            UDim2.new(0, iconSize, 0, iconSize), 
            C.PANEL, 
            function()
                blur:Destroy()
            end
        )
    end
    
    local btnPad = Instance.new("UIPadding", btnBar)
    btnPad.PaddingLeft = UDim.new(0, 5 * scaleFactor)
    btnPad.PaddingRight = UDim.new(0, 5 * scaleFactor)
    btnPad.PaddingTop = UDim.new(0, 3 * scaleFactor)
    btnPad.PaddingBottom = UDim.new(0, 3 * scaleFactor)
    
    local editorButtons = cEl("Frame", btnBar, {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Visible = true
    })
    
    local scriptsButtons = cEl("Frame", btnBar, {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Visible = false
    })
    
    local utilsButtons = cEl("Frame", btnBar, {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Visible = false
    })
    
    local cloudButtons = cEl("Frame", btnBar, {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Visible = false
    })
    
    local editorFlow = Instance.new("UIListLayout", editorButtons)
    editorFlow.FillDirection = Enum.FillDirection.Horizontal
    editorFlow.HorizontalAlignment = Enum.HorizontalAlignment.Center
    editorFlow.VerticalAlignment = Enum.VerticalAlignment.Center
    editorFlow.Padding = UDim.new(0, 5 * scaleFactor)
    
    local scriptsFlow = Instance.new("UIListLayout", scriptsButtons)
    scriptsFlow.FillDirection = Enum.FillDirection.Horizontal
    scriptsFlow.HorizontalAlignment = Enum.HorizontalAlignment.Center
    scriptsFlow.VerticalAlignment = Enum.VerticalAlignment.Center
    scriptsFlow.Padding = UDim.new(0, 5 * scaleFactor)
    
    local utilsFlow = Instance.new("UIListLayout", utilsButtons)
    utilsFlow.FillDirection = Enum.FillDirection.Horizontal
    utilsFlow.HorizontalAlignment = Enum.HorizontalAlignment.Center
    utilsFlow.VerticalAlignment = Enum.VerticalAlignment.Center
    utilsFlow.Padding = UDim.new(0, 5 * scaleFactor)
    
    local cloudFlow = Instance.new("UIListLayout", cloudButtons)
    cloudFlow.FillDirection = Enum.FillDirection.Horizontal
    cloudFlow.HorizontalAlignment = Enum.HorizontalAlignment.Center
    cloudFlow.VerticalAlignment = Enum.VerticalAlignment.Center
    cloudFlow.Padding = UDim.new(0, 5 * scaleFactor)
    
    local exBtn = cBtn(editorButtons, "Execute", nil, UDim2.new(0.33, -4 * scaleFactor, 1, -6 * scaleFactor), C.ACC, function()
        local success, result = pcall(function()
            return loadstring(ceTextBox.Text)()
        end)
        
        if success then
            showNotification("Executed", "Script executed", "success")
        else
            showNotification("Error", "Execution failed", "error")
        end
    end)
    
    local iconSize = landscape and 14 * scaleFactor or 16 * scaleFactor
    
    local exIcon = cEl("ImageLabel", exBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6026663699",
        ImageColor3 = C.TXT
    })
    
    exBtn.Text = "    Execute"
    
    local clrBtn = cBtn(editorButtons, "Clear", nil, UDim2.new(0.33, -4 * scaleFactor, 1, -6 * scaleFactor), C.WARN, function()
        ceTextBox.Text = ""
        showNotification("Cleared", "Editor cleared", "warning")
    end)
    
    local clrIcon = cEl("ImageLabel", clrBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6035047391",
        ImageColor3 = C.TXT
    })
    
    clrBtn.Text = "    Clear"
    
    local svBtn = cBtn(editorButtons, "Save", nil, UDim2.new(0.33, -4 * scaleFactor, 1, -6 * scaleFactor), C.PINK, function()
        showSave()
    end)
    
    local svIcon = cEl("ImageLabel", svBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6026568198",
        ImageColor3 = C.TXT
    })
    
    svBtn.Text = "    Save"
    
    local refreshBtn = cBtn(scriptsButtons, "Refresh", nil, UDim2.new(1, -10 * scaleFactor, 1, -6 * scaleFactor), C.ACC, function()
        refScr()
        showNotification("Refreshed", "Scripts refreshed", "success")
    end)
    
    local refreshIcon = cEl("ImageLabel", refreshBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6031097225",
        ImageColor3 = C.TXT
    })
    
    refreshBtn.Text = "    Refresh"
    
    local conBtn = cBtn(utilsButtons, "Console", nil, UDim2.new(1, -10 * scaleFactor, 1, -6 * scaleFactor), C.LAVENDER, function()
        openCon()
        showNotification("Console", "Developer console opened", "success")
    end)
    
    local conIcon = cEl("ImageLabel", conBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6031075931",
        ImageColor3 = C.TXT
    })
    
    conBtn.Text = "    Console"
    
    local execCloudBtn = cBtn(cloudButtons, "Execute", nil, UDim2.new(0.5, -3 * scaleFactor, 1, -6 * scaleFactor), C.ACC, function()
        local success, result = pcall(function()
            return loadstring(ceTextBox.Text)()
        end)
        
        if success then
            showNotification("Executed", "Script executed", "success")
        else
            showNotification("Error", "Execution failed", "error")
        end
    end)
    
    local execCloudIcon = cEl("ImageLabel", execCloudBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6026663699",
        ImageColor3 = C.TXT
    })
    
    execCloudBtn.Text = "    Execute"
    
    local saveCloudBtn = cBtn(cloudButtons, "Save", nil, UDim2.new(0.5, -3 * scaleFactor, 1, -6 * scaleFactor), C.PINK, function()
        showSave()
    end)
    
    local saveCloudIcon = cEl("ImageLabel", saveCloudBtn, {
        Size = UDim2.new(0, iconSize, 0, iconSize),
        Position = UDim2.new(0, 8 * scaleFactor, 0.5, -iconSize/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6026568198",
        ImageColor3 = C.TXT
    })
    
    saveCloudBtn.Text = "    Save"
    
    editorBtn.MouseButton1Click:Connect(function()
        editorPanel.Visible = true
        scriptsPanel.Visible = false
        utilsPanel.Visible = false
        cloudPanel.Visible = false
        
        editorBtn.BackgroundColor3 = C.ACC
        scriptsBtn.BackgroundColor3 = C.SEC
        utilsBtn.BackgroundColor3 = C.SEC
        cloudBtn.BackgroundColor3 = C.SEC
        
        editorButtons.Visible = true
        scriptsButtons.Visible = false
        utilsButtons.Visible = false
        cloudButtons.Visible = false
    end)
    
    scriptsBtn.MouseButton1Click:Connect(function()
        editorPanel.Visible = false
        scriptsPanel.Visible = true
        utilsPanel.Visible = false
        cloudPanel.Visible = false
        
        editorBtn.BackgroundColor3 = C.SEC
        scriptsBtn.BackgroundColor3 = C.ACC
        utilsBtn.BackgroundColor3 = C.SEC
        cloudBtn.BackgroundColor3 = C.SEC
        
        editorButtons.Visible = false
        scriptsButtons.Visible = true
        utilsButtons.Visible = false
        cloudButtons.Visible = false
        
        refScr()
    end)
    
    utilsBtn.MouseButton1Click:Connect(function()
        editorPanel.Visible = false
        scriptsPanel.Visible = false
        utilsPanel.Visible = true
        cloudPanel.Visible = false
        
        editorBtn.BackgroundColor3 = C.SEC
        scriptsBtn.BackgroundColor3 = C.SEC
        utilsBtn.BackgroundColor3 = C.ACC
        cloudBtn.BackgroundColor3 = C.SEC
        
        editorButtons.Visible = false
        scriptsButtons.Visible = false
        utilsButtons.Visible = true
        cloudButtons.Visible = false
    end)
    
    cloudBtn.MouseButton1Click:Connect(function()
        editorPanel.Visible = false
        scriptsPanel.Visible = false
        utilsPanel.Visible = false
        cloudPanel.Visible = true
        
        editorBtn.BackgroundColor3 = C.SEC
        scriptsBtn.BackgroundColor3 = C.SEC
        utilsBtn.BackgroundColor3 = C.SEC
        cloudBtn.BackgroundColor3 = C.ACC
        
        editorButtons.Visible = false
        scriptsButtons.Visible = false
        utilsButtons.Visible = false
        cloudButtons.Visible = true
    end)
    
    local isDrag = false
    local dragSt = nil
    local stPos = nil
    
    tb.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDrag = true
            dragSt = input.Position
            stPos = mf.Position
        end
    end)
    
    tb.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDrag = false
        end
    end)
    
    UIS.InputChanged:Connect(function(input)
        if isDrag and dragSt and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragSt
            
            local newX = stPos.X.Offset + delta.X
            local newY = stPos.Y.Offset + delta.Y
            
            mf.Position = UDim2.new(stPos.X.Scale, newX, stPos.Y.Scale, newY)
        end
    end)
    
    refScr()
    
    shadow.ImageTransparency = 1
    
    TS:Create(shadow, TweenInfo.new(0.8), {
        ImageTransparency = 0.6
    }):Play()
    
    UIS.WindowFocusReleased:Connect(function()
        isDrag = false
    end)
    
    UIS.WindowFocused:Connect(function()
        isDrag = false
    end)
    
    local function updateLayout()
        local newScreenWidth, newScreenHeight = getScreenSize()
        local newMobile = isMobile()
        local newLandscape = isLandscape()
        
        if newMobile ~= mobile or newLandscape ~= landscape or newScreenWidth ~= screenWidth or newScreenHeight ~= screenHeight then
            showEd()
        end
    end
    
    local resizeConnection
    resizeConnection = game:GetService("RunService").RenderStepped:Connect(function()
        if not sg.Parent then
            resizeConnection:Disconnect()
            if featherConnection then
                featherConnection:Disconnect()
            end
            return
        end
        
        local newWidth, newHeight = getScreenSize()
        if newWidth ~= screenWidth or newHeight ~= screenHeight then
            screenWidth, screenHeight = newWidth, newHeight
            updateLayout()
        end
    end)
    
    showNotification("HeatherX", "Welcome to HeatherX", "success")
end

local function setupTBI()
    local tba = CG:WaitForChild("TopBarApp", 5)
    if not tba then return end
    
    local ulf = tba:WaitForChild("TopBarApp", 5):WaitForChild("UnibarLeftFrame", 5)
    if not ulf then return end
    
    local um = ulf:WaitForChild("UnibarMenu", 5)
    if not um then return end
    
    local smh = um:WaitForChild("SubMenuHost", 5)
    if not smh then return end
    
    smh.ChildAdded:Connect(function(child)
        if child.Name == "nine_dot" then
            task.delay(0.3, function()
                local btn = child:FindFirstChild("trust_and_safety", true)
                if btn and btn:IsA("ImageButton") then
                    local clone = btn:Clone()
                    clone.LayoutOrder = 1
                    
                    local label = clone:FindFirstChild("StyledTextLabel", true)
                    if label then 
                        label.Text = "HeatherX"
                        label.TextColor3 = C.PINK
                    end
                    
                    local icon = clone:FindFirstChild("IntegrationIcon", true)
                    if icon and icon:IsA("ImageLabel") then
                        icon.Image = "rbxassetid://116872248658338"
                        icon.ScaleType = Enum.ScaleType.Fit
                        icon.ImageRectSize = Vector2.new(0, 0)
                        icon.ImageRectOffset = Vector2.new(0, 0)
                        icon.SliceScale = 1
                        icon.BackgroundTransparency = 1
                    end
                    
                    clone.MouseButton1Click:Connect(function()
                        showEd()
                    end)
                    
                    clone.Parent = btn.Parent
                end
            end)
        end
    end)
end

setupTBI()
showEd()